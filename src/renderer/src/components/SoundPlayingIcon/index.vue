<script setup>
/**
 * SoundPlayingIcon - 语音播报图标组件
 * 支持三种状态：静态开启、静态关闭、播报中动画
 */
import { computed } from 'vue'

const props = defineProps({
  // 图标状态：'on' 静态开启, 'off' 静态关闭, 'playing' 播报中动画
  status: {
    type: String,
    default: 'on',
    validator: (value) => ['on', 'off', 'playing'].includes(value)
  },
  // 图标颜色（喇叭部分）
  color: {
    type: String,
    default: '#fffffe'
  },
  // 音波颜色（播报中状态的音波部分，不传则跟随 color）
  waveColor: {
    type: String,
    default: ''
  },
  // 图标大小
  size: {
    type: [Number, String],
    default: 20
  }
})

// 计算音波颜色
const computedWaveColor = computed(() => props.waveColor || props.color)

// 计算样式
const iconStyle = computed(() => {
  const size = typeof props.size === 'number' ? `${props.size}px` : props.size
  return {
    width: size,
    height: size,
    color: props.color
  }
})
</script>

<template>
  <!-- 播报中动画 -->
  <svg
    v-if="status === 'playing'"
    viewBox="0 0 40 40"
    version="1.1"
    xmlns="http://www.w3.org/2000/svg"
    class="sound-icon sound-icon--playing"
    :style="iconStyle"
  >
    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
      <path
        d="M19.1903864,4.35883706 C18.883652,4.04386778 18.3836986,3.99976367 18.0246963,4.27257418 L11.4994789,9.23117125 C10.7313086,9.81491381 9.79373206,10.1308732 8.82970739,10.1308732 L3.53498108,10.1308732 C1.58266493,10.1308732 0,11.7170263 0,13.6736453 L0,26.3264033 C0,28.2830223 1.58266493,29.8691754 3.53498108,29.8691754 L8.82970739,29.8691754 C9.79373206,29.8691754 10.7313086,30.1851349 11.4994789,30.7688773 L18.0246963,35.7274744 C18.1783303,35.8442229 18.3658456,35.9074148 18.5586505,35.9074148 C19.0467296,35.9074148 19.4423958,35.5108765 19.4423958,35.0217217 L19.4423958,4.97832687 C19.4423958,4.78509699 19.3793429,4.59716838 19.2628512,4.44319571 L19.1903864,4.35883706 Z"
        fill="currentColor"
        class="sound-speaker"
      />
      <path
        d="M26.7205987,10.7206747 C30.0129679,13.4800096 31.7517109,16.394491 31.7517109,19.4844819 C31.7517109,22.4808368 30.1167496,25.3121578 27.0156199,27.9970126 L26.7205987,28.2482892 L24.5344579,25.385469 C27.0746436,23.2565392 28.252178,21.2827557 28.252178,19.4844819 C28.252178,17.7482176 27.1544527,15.8483391 24.7923825,13.8031747 L24.5344579,13.5834948 L26.7205987,10.7206747 Z"
        :fill="computedWaveColor"
        class="sound-wave-1"
      />
      <path
        d="M33.2408742,5.56549402 C37.7076723,10.2599683 40,15.078307 40,20 C40,24.8016517 37.8181296,29.5049293 33.5638307,34.0907871 L33.2408742,34.434506 L30.7206747,31.7858501 C34.5701104,27.7402057 36.4358997,23.8184257 36.4358997,20 C36.4358997,16.2876417 34.6723258,12.4775913 31.0368717,8.55100073 L30.7206747,8.21414998 L33.2408742,5.56549402 Z"
        :fill="computedWaveColor"
        class="sound-wave-2"
      />
    </g>
  </svg>

  <!-- 静态开启 -->
  <svg
    v-else-if="status === 'on'"
    viewBox="0 0 40 40"
    version="1.1"
    xmlns="http://www.w3.org/2000/svg"
    class="sound-icon sound-icon--on"
    :style="iconStyle"
  >
    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
      <g fill="currentColor" fill-rule="nonzero">
        <path
          d="M26.7205987,10.7206747 C30.0129679,13.4800096 31.7517109,16.3944909 31.7517109,19.4844819 C31.7517109,22.4808368 30.1167496,25.3121578 27.0156199,27.9970125 L26.7205987,28.2482891 L24.5344579,25.385469 C27.0746436,23.2565392 28.252178,21.2827557 28.252178,19.4844819 C28.252178,17.7482176 27.1544527,15.848339 24.7923825,13.8031747 L24.5344579,13.5834948 L26.7205987,10.7206747 Z"
        />
        <path
          d="M33.2408742,5.565494 C37.7076723,10.2599683 40,15.078307 40,20 C40,24.8016517 37.8181296,29.5049293 33.5638307,34.0907871 L33.2408742,34.434506 L30.7206747,31.78585 C34.5701104,27.7402057 36.4358997,23.8184257 36.4358997,20 C36.4358997,16.2876417 34.6723258,12.4775912 31.0368717,8.55100071 L30.7206747,8.21414997 L33.2408742,5.565494 Z"
        />
        <path
          d="M16.0693692,10.5538383 C17.9879246,10.5538383 19.543221,12.1200121 19.5432210,14.0519855 L19.5425588,19.1797143 C19.5424794,19.7944889 19.7312752,20.3944462 20.0833952,20.8983899 L25.0932818,28.0683926 C25.369279,28.4634102 25.2750181,29.0089399 24.882744,29.2868675 C24.7364336,29.3905289 24.5619026,29.4461617 24.3830068,29.4461617 L-4.1537004,29.4461617 C-4.63333924,29.4461617 -5.02216335,29.0546183 -5.02216335,28.5716249 C-5.02216335,28.391478 -4.96691692,28.2157264 -4.8639754,28.0683926 L0.144652875,20.8989253 C0.496522377,20.3952511 0.685258355,19.7956831 0.685346823,19.1812729 L0.686085383,14.0519855 C0.686085383,12.1200121 2.2413818,10.5538383 4.15993717,10.5538383 L16.0693692,10.5538383 Z M16.0693692,12.4972534 L4.15993717,12.4972534 C3.30724592,12.4972534 2.61600309,13.1933307 2.61600307,14.0522673 L2.6151286,20.1254397 L2.61504006,20.7403923 L2.26366781,21.2433547 L-2.10930993,27.5023619 L22.3379226,27.5023619 L17.9640722,21.2425151 L17.6124397,20.7392689 L17.6125191,20.1239335 L17.6133033,14.0519855 C17.6133033,13.1933307 16.9220604,12.4972534 16.0693692,12.4972534 Z"
          stroke="currentColor"
          stroke-width="1.2"
          transform="translate(10.1147, 20) rotate(-90) translate(-10.1147, -20)"
        />
      </g>
    </g>
  </svg>

  <!-- 静态关闭 -->
  <svg
    v-else
    viewBox="0 0 40 40"
    version="1.1"
    xmlns="http://www.w3.org/2000/svg"
    class="sound-icon sound-icon--off"
    :style="iconStyle"
  >
    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
      <g fill="currentColor" fill-rule="nonzero" stroke="currentColor">
        <g transform="translate(24.0733, 12.5)" stroke-width="1.07142857">
          <path
            d="M1.37693604,14.9999814 L1.85726062e-05,13.6231383 L13.6241226,0 L15,1.37691747 L1.37693604,14.9999814 Z M13.6241226,14.9999814 L0,1.37691747 L1.37693604,0 L15,13.6231383 L13.6241412,14.9999814 L13.6241226,14.9999814 Z"
          />
        </g>
        <path
          d="M16.0895809,10.5538383 C18.0081362,10.5538383 19.5634327,12.1200121 19.5634327,14.0519855 L19.5627705,19.1797143 C19.5626911,19.7944889 19.7514869,20.3944462 20.1036068,20.8983899 L25.1134934,28.0683926 C25.3894907,28.4634102 25.2952297,29.0089399 24.9029557,29.2868675 C24.7566452,29.3905289 24.5821142,29.4461617 24.4032184,29.4461617 L-4.13348873,29.4461617 C-4.61312757,29.4461617 -5.00195168,29.0546183 -5.00195168,28.5716249 C-5.00195168,28.391478 -4.94670525,28.2157264 -4.84376373,28.0683926 L0.164864543,20.8989253 C0.516734045,20.3952511 0.705470023,19.7956831 0.705558491,19.1812729 L0.706297051,14.0519855 C0.706297051,12.1200121 2.26159347,10.5538383 4.18014883,10.5538383 L16.0895809,10.5538383 Z M16.0895809,12.4972534 L4.18014883,12.4972534 C3.32745759,12.4972534 2.63621476,13.1933307 2.63621474,14.0522673 L2.63534027,20.1254397 L2.63525172,20.7403923 L2.28387947,21.2433547 L-2.08909826,27.5023619 L22.3581343,27.5023619 L17.9842839,21.2425151 L17.6326514,20.7392689 L17.6327308,20.1239335 L17.6335149,14.0519855 C17.6335149,13.1933307 16.9422721,12.4972534 16.0895809,12.4972534 Z"
          stroke-width="1.2"
          transform="translate(10.1349, 20) rotate(-90) translate(-10.1349, -20)"
        />
      </g>
    </g>
  </svg>
</template>

<style lang="scss" scoped>
.sound-icon {
  display: inline-block;
  vertical-align: middle;
}

/* 播报中动画 */
.sound-icon--playing {
  .sound-speaker {
    transform: scale(1);
    animation: speaker-pulse 1s ease-in-out infinite;
    transform-origin: center;
  }

  .sound-wave-1 {
    visibility: visible;
    opacity: 1;
    animation: wave1-animate 1s ease-in infinite;
  }

  .sound-wave-2 {
    visibility: visible;
    opacity: 1;
    animation: wave2-animate 1s ease-in infinite;
  }
}

@keyframes speaker-pulse {
  0% {
    transform: scale(1);
  }
  100% {
    transform: scale(1.01);
  }
}

@keyframes wave1-animate {
  0% {
    visibility: hidden;
    opacity: 0;
  }
  20%,
  70% {
    visibility: visible;
    opacity: 1;
  }
  71%,
  100% {
    visibility: hidden;
    opacity: 0;
  }
}

@keyframes wave2-animate {
  0% {
    visibility: hidden;
    opacity: 0;
  }
  60%,
  70% {
    visibility: visible;
    opacity: 1;
  }
  71%,
  100% {
    visibility: hidden;
    opacity: 0;
  }
}
</style>
